# 프로젝트 PRD — 데스크톱(PySide2) 기반 컷에디터 → 웹 애플리케이션 전환

## 1) 개요

* **목적**: 기존 PySide2(OpenCV/PIL) 기반 컷에디터(2/4/6/9칸 이미지 배치, 프레임 오버레이, 텍스트 합성, 고해상도 내보내기)를 **브라우저에서 누구나 접속해 사용할 수 있는 웹 서비스**로 재구성한다.
* **접속량 가정**: 월평균 \~100회(저트래픽). **정적 호스팅+완전 클라이언트 사이드**(백엔드 0 또는 최소화)로도 충분.
* **사용 시나리오**: 매장/고객이 웹 주소로 접속 → 레이아웃 선택(2/4/6/9컷 × 가로/세로) → 사진 업로드/배치 → 텍스트 입력 → 프레임/오버레이 적용 → 고해상도 이미지 저장/인쇄.
* **비전**: 매장 PC/키오스크, 고객 스마트폰 어디서든 동일한 UX. 설치/업데이트 없이 즉시 사용.

## 2) 현행 기능(코드 분석 요약)과 문제점

### 2.1 제공 기능(요약)

* **레이아웃**: 2/4/6/9컷 × 가로/세로 각각의 페이지(스택) 보유.
* **프레임 오버레이**: 파일명 규칙(`2_horizontal`, `4_가로`, `9_vertical` 등)으로 모드 추론 후 PNG 오버레이를 최상단에 합성.
* **이미지 조작**: 각 슬롯에 드래그 이동, 마우스 휠 확대/축소, 수치 입력을 통한 스케일 조정.
* **정렬 가이드**: 슬롯 중앙 십자선 가이드 표시.
* **텍스트**: 다중 라벨에 폰트 적용 및 **기울임(italic 유사, shear 변환)** 효과로 렌더링.
* **고해상도 내보내기**: 현재 **1200 DPI 기준 10×15/15×10cm 캔버스**에 합성 후 PNG/JPEG로 저장.

### 2.2 개선 여지

* **파일명 의존 템플릿 추론**: 취약(오입력 시 실패). 템플릿 **메타데이터** 구조화 필요.
* **텍스트 기울기 고정**: 사용자가 각도/기울기, 자간/행간 제어 불가.
* **가이드/안전선**: 인쇄를 위한 bleed/safe-zone 부족.
* **단계형 UX 부족**: 초심자에게 러닝커브가 큼(프레임 선택 → 배치 → 내보내기 흐름 단순화 필요).

## 3) 범위

### 3.1 In-Scope (MVP)

1. **레이아웃 템플릿 시스템**(2/4/6/9컷 × 가로/세로, JSON 기반 메타): 슬롯 좌표/크기, 오버레이 PNG, 캔버스 규격.
2. **클라이언트 전용 합성 파이프라인**: Canvas/WebGL 기반 렌더링, OffscreenCanvas+Web Worker로 고해상도 합성.
3. **이미지 조작**: 드래그/핀치/휠 확대축소, 더블탭 리셋, 슬롯 맞춤(채우기/맞춤/자르기), 스냅(중앙/가이드).
4. **텍스트 도구**: 폰트 선택(Noto Sans KR 등 웹폰트), 크기, 굵기, 자간/행간, 기울기(숫자 조절), 정렬(가/세로 정렬 지원).
5. **가이드**: 중앙선/그리드, 인쇄용 **bleed/safe-zone** 토글.
6. **내보내기**: PNG(기본) 메타에 정의된 실사이즈(cm/mm)→픽셀 자동 변환.
7. **모바일/데스크톱 호환**: 터치 제스처, 소형 화면 최적화.
8. **완전 로컬 처리**: 이미지/결과물 **서버 저장 없음**(개인정보/저작권 보호, 트래픽 절감).

### 3.2 Post-MVP(선택)

* **히스토리(Undo/Redo)**, **그룹 복제/정렬**, 품질보정(밝기/대비/색온도), **템플릿 관리자(브라우저 로컬 저장)**.

### 3.3 Out-of-Scope

* 회원/로그인, 서버 영구저장, 대용량 갤러리, 유료결제.

## 4) 사용자 & 주요 여정

* **고객**: PC에서 접속 → 레이아웃 고르기 → 사진 여러 장 업로드 → 슬롯 자동채우기 → 간단 편집 → PNG 저장.
    - 각 슬롯마다 사진 한 장씩 업로드 기능 포함

### 핵심 플로우(마법사 3단계)

1. **템플릿 선택**(2/4/6/9컷, 가로/세로, 미리보기)
2. **편집**(사진 배치/확대/가이드/텍스트)
3. **내보내기**(DPI/포맷 고정 (600, PNG))

## 5) UX 요구사항 (UI/UX 개선)

* 좌측: 템플릿/옵션 패널, 중앙: 캔버스, 우측: 속성 패널(선택 대상에 따라 컨텍스트 메뉴).
* **슬롯 자동채우기**(업로드 n장을 좌→우, 상→하 순서로 배치) + **빈 슬롯 강조**.
* **스냅/가이드**: 슬롯 경계/중심/그리드 스냅, 가이드 색상/투명도 조절.
* **텍스트 라이브 미리보기**: 폰트, 크기, 기울기(−20°\~+20°), 자간/행간, 그림자/외곽선 옵션.
* **접근성**: 키보드 단축키(⌘/Ctrl+Z/Y, Delete, +/-), 명확한 포커스, 색대비.

## 6) 기능 요구사항 (일부 기능 개조)

* **템플릿 메타데이터화**: 파일명 추론 → **JSON 스키마** 기반 선택으로 변경.
* **텍스트 엔진 고도화**: shear 고정값 → **각도/자간/행간/정렬/외곽선** 옵션화.
* **해상도 프리셋**: 600 PDI 고정.
* **일괄 업로드/자동배치** + 슬롯별 **채우기(Fill)/맞춤(Contain)/자르기(Cover)** 모드.
* **내보내기 파이프라인**: 메인 스레드 프리징 방지(Worker), 큰 캔버스 타일링 렌더.

## 7) 시스템 설계 제안

* **프런트엔드**: **React + Vite**(경량) 또는 **Next.js**(라우팅/배포 편의).
* **렌더링**: **Fabric.js** 또는 **Konva.js**(캔버스 오브젝트/트랜스폼 관리), 고해상도는 **OffscreenCanvas + Web Worker**로 별도 렌더.
* **이미지 처리**: 브라우저 **Canvas** API(자르기/스케일), 필요 시 **WebGL** 가속.
* **폰트**: Google Fonts(Noto Sans KR 등) + 로컬 업로드 옵션.
* **배포/호스팅**: **정적 호스팅**(Vercel/Netlify/Cloudflare Pages 등). **백엔드 불필요**.
* **저장**: 브라우저 메모리/IndexedDB(세션 임시 저장, 복구용). 서버 저장 없음.

## 8) 템플릿 JSON 스키마(초안)

```json
{
  "id": "4-hor",
  "name": "4컷-가로",
  "canvas": {"width_mm": 150, "height_mm": 100, "dpi": 600, "bleed_mm": 1.5, "safe_mm": 2.0, "background": "#ffffff"},
  "overlay": "/overlays/4_horizontal.png",
  "slots": [
    {"x_mm": 5, "y_mm": 5, "w_mm": 32, "h_mm": 42, "rotation": 0},
    {"x_mm": 41, "y_mm": 5, "w_mm": 32, "h_mm": 42, "rotation": 0}
  ],
  "texts": [
    {"x_mm": 75, "y_mm": 95, "w_mm": 60, "h_mm": 10, "align": "center", "style": {"font": "Noto Sans KR", "size_pt": 12, "italic_deg": 12, "letter": 0, "line": 1}}
  ]
}
```

> mm→px 변환: `px = mm / 25.4 * dpi`.

## 9) 비기능 요구사항

* **성능**: 300 DPI는 모바일 보장, 600 DPI는 최신 중급 기기 권장. 워커 사용 시 메인 스레드 16ms 프레임 유지.
* **호환성**: 최신 Chrome/Safari/Edge/Firefox. iOS Safari 메모리 제약 시 타일링/스트리밍 합성.
* **보안/프라이버시**: 이미지 처리 **로컬 전용**. 외부 전송 없음.
* **접근성**: WCAG AA 텍스트 대비, 키보드 조작.

## 10) 성공 지표

* 내보내기 성공률(에러 없이 저장) ≥ 99%
* 평균 내보내기 소요 시간(600 DPI, 4컷) 만족도 4/5 이상
* 편집 중 이탈률 < 10%

## 11) QA/수용 기준 (샘플)

1. 2/4/6/9컷 모든 템플릿에서 **빈 슬롯/저해상도 경고** 동작.
2. 300/600 DPI 선택 시 결과 캔버스 픽셀 수가 스펙에 부합.
3. 텍스트 기울기/자간/행간/정렬이 설정값대로 반영.
4. PNG 투명 오버레이가 최상단에 정확히 합성.
5. 모바일 핀치/드래그/더블탭 리셋 정상.

## 12) 마이그레이션 가이드(현행 → 웹)

* **파일명 규칙 파싱** → **JSON 템플릿**으로 치환(좌표/오버레이 경로/텍스트 박스 정의).
* **OpenCV/PIL 합성** → **Canvas/WebGL 합성**(알파/오버레이 동일 유지).
* **기울임 글자**(shear) → **숫자 입력 슬라이더**.
* **중앙선 가이드** 유지, 색상/투명도 옵션 추가.

## 13) 리스크 & 대응

* **모바일 메모리 한계**: 타일링/워커, DPI 권장치 안내.
* **폰트 라이선스**: Noto/본고딕 등 오픈 폰트 기본 제공, 외부 업로드 시 고지.
* **색차**: sRGB 고정, 브라우저 컬러매니지먼트 주의사항 문서화.

## 14) 운영/배포

* **배포**: GitHub Actions → 정적 호스팅.
* **로깅**: 클라이언트 오류만(템플릿/내보내기 실패, 메모리 오류). PII 없음.
* **코스트**: 월 100회 기준 정적 호스팅 무료/저비용 영역.

---

### 부록) 현행 코드 기준 기능 매핑

* **레이아웃 스택**: 2/4/6/9 × 가/세로 페이지 → 웹에서는 **템플릿 JSON**으로 통합.
* **오버레이 합성**: QLabel 상단 PNG → 캔버스 레이어(Z-order 고정).
* **중앙 가이드**: OpenCV 라인 드로잉 → 캔버스 가이드 레이어 토글.
* **텍스트**: PIL+shea r → 캔버스 텍스트 객체(기울기/자간/행간 UI 추가).
* **600 DPI 합성**: OpenCV+PIL → OffscreenCanvas 고해상도 렌더(프리셋).
* **스케일/이동**: 드래그/휠/수치 입력 → 터치 제스처 및 속성 패널 병행.
